cotizacionesSchema.pre('save', function(next) {
    // Calcula subtotales si no estÃ¡n definidos
    this.productos.forEach(producto => {
        if (!producto.subtotal) {
            producto.subtotal = producto.precioUnitario * producto.cantidad;
        }
    });

    // Calcula el total
    this.total = this.productos.reduce((sum, producto) => sum + producto.subtotal, 0);
    this.total = this.total - (this.descuento || 0) + (this.impuesto || 0);

    // Establece validaHasta si no existe
    if (!this.validaHasta) {
        const fechaVencimiento = new Date(this.fecha || Date.now());
        fechaVencimiento.setDate(fechaVencimiento.getDate() + 30);
        this.validaHasta = fechaVencimiento;
    }

    next();
});